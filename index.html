<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>HondaGo</title>

  <!-- Manifest PWA -->
  <link rel="manifest" href="manifest.json" />

  <!-- CSS principal -->
  <link rel="stylesheet" href="css/styles.css" />

  <!-- √çcono PWA -->
  <link rel="icon" href="img/icono-pwa.png" />
  <link rel="apple-touch-icon" href="img/icono-pwa.png" />

  <!-- Precarga im√°genes de autos -->
  <link rel="preload" as="image" href="img/city.png" />
  <link rel="preload" as="image" href="img/civic.png" />
  <link rel="preload" as="image" href="img/accord.png" />
  <link rel="preload" as="image" href="img/brv.png" />
  <link rel="preload" as="image" href="img/hrv.png" />
  <link rel="preload" as="image" href="img/crv.png" />
  <link rel="preload" as="image" href="img/pilot.png" />
  <link rel="preload" as="image" href="img/odyssey.png" />

  <!-- Precarga √≠conos del men√∫ -->
  <link rel="preload" as="image" href="icons/vehiculo.svg" />
  <link rel="preload" as="image" href="icons/financiamiento.svg" />
  <!-- <link rel="preload" as="image" href="icons/mas.svg" /> -->

  <!-- FullCalendar CSS + locale ES -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/locales-all.global.min.js"></script>


  <!-- Google Material Icons (para botones) -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
</head>

<body>
  <div class="app-container">
    <!-- HEADER -->
    <header class="app-header">
      <div class="header-center">
        <h1>HondaGo</h1>
      </div>
      <button id="toggle-darkmode" class="darkmode-btn" aria-label="Cambiar modo">
        <span class="material-icons" id="icon-darkmode">dark_mode</span>
      </button>
    </header>

    <main class="main-content">
      <!-- === SECCI√ìN VEH√çCULOS (Cotizador y Env√≠o) === -->
      <section id="vehiculos" class="tab-section active">
        <img src="img/logo-honda.png" alt="Logo Honda" id="logo-vehiculo" />
        <h2>Veh√≠culos</h2>

        <div id="selector-menu">
          <select id="modelo" onchange="cargarVersiones()">
            <option value="">--Selecciona modelo--</option>
          </select>
          <select id="version" onchange="actualizarPrecio()">
            <option value="">--Selecciona versi√≥n--</option>
          </select>
        </div>

        <img id="imagen" src="" alt="Veh√≠culo" />
        <div id="info-modelo"></div>

        <button id="btn-generar" class="btn-action" onclick="generarPDF()" disabled>Generar PDF</button>

        <!-- QR de contacto oculto -->
        <div id="qr-contacto" style="display: none">
          <p><strong>Escan√©ame para guardarme como contacto:</strong></p>
          <img src="img/qr_vcard.png" alt="QR vCard" />
        </div>

        <!-- Formulario de WhatsApp -->
        <div id="form-whatsapp">
          <h3>Enviar ficha al cliente</h3>

          <label for="nombre-cliente">Nombre del cliente</label>
          <input type="text" id="nombre-cliente" placeholder="Ej. Juan P√©rez" autocomplete="name" />

          <label for="telefono-cliente">N√∫mero WhatsApp:</label>
          <input type="tel" id="telefono-cliente" placeholder="52XXXXXXXXXX" />

          <button class="btn-action" id="btn-enviar" type="button" onclick="enviarACliente()">üöÄ Enviar
            WhatsApp</button>
        </div>
      </section>

      <!-- === SECCI√ìN FINANCIAMIENTO === -->
      <section id="financiamiento" class="tab-section">
        <h2>Financiamiento</h2>

        <h3>Oferta comercial del mes</h3>
        <iframe src="pdf/oferta.pdf" width="100%" height="600" loading="lazy"></iframe>

        <h3>Bonos e Incentivos</h3>
        <iframe src="pdf/descuentos.pdf" width="100%" height="600" loading="lazy"></iframe>
      </section>

      <!-- === SECCI√ìN M√ÅS (CALENDARIO, CR√âDITOS, ACTUALIZACI√ìN, LEADS) === -->
      <section id="mas" class="tab-section">
        <div class="menu-mas">
          <button class="btn-action btn-mas" onclick="mostrarSubseccionMas('calendario')">
            <span class="material-icons">calendar_month</span>
            Guardias y Recordatorios
          </button>

          <button class="btn-action btn-mas" onclick="mostrarSubseccionMas('creditos')">
            <span class="material-icons">info</span>
            Cr√©ditos y Contacto
          </button>

          <button class="btn-action btn-mas" onclick="mostrarSubseccionMas('leads')">
            <span class="material-icons">group</span>
            Leads
          </button>

          <!-- Solo visible si hay actualizaci√≥n -->
          <button id="btn-mas-actualizar" class="btn-action btn-mas" style="display: none"
            onclick="mostrarSubseccionMas('actualizacion')">
            <span class="material-icons">update</span>
            Actualizar App
          </button>
        </div>

        <!-- Sub-secciones (se muestra una a la vez) -->
        <div id="sub-mas-calendario" class="sub-mas" style="display: none">
          <h2>Mis guardias</h2>
          <div id="calendario-guardias" style="width: 100%"></div>
        </div>

        <div id="sub-mas-creditos" class="sub-mas" style="display: none">
          <div class="creditos-container">
            <img src="img/logo-honda.png" alt="Honda Logo" class="logo-creditos" />
            <h2>Cr√©ditos</h2>
            <p><strong>Desarrollado por:</strong> Israel Ortiz</p>
            <p><strong>Versi√≥n:</strong> 1.1 ¬∑ 2025</p>
            <p><strong>Correo:</strong> fortiz.hondamontejo@gmail.com</p>
            <p><strong>Facebook:</strong> <a href="https://fb.com/honda.israelortiz"
                target="_blank">fb.com/honda.israelortiz</a></p>
            <p class="footer-copy">¬© HondaGo ¬∑ Todos los derechos reservados</p>
          </div>
        </div>
        <div id="sub-mas-leads" class="sub-mas" style="display:none">
          <h2>Leads (feria)</h2>
          <p class="lead-meta">Guardados: <strong id="lead-count">0</strong></p>

          <!-- Toolbar compacta -->
          <div class="lead-toolbar">
            <input id="lead-search" type="search" placeholder="Buscar (nombre / tel√©fono / modelo)"
              oninput="setLeadSearch(this.value)">
            <select id="lead-size" onchange="setLeadPageSize(this.value)">
              <option value="25">25</option>
              <option value="50" selected>50</option>
              <option value="100">100</option>
            </select>
            <button class="btn btn-ghost" onclick="exportLeadsCSV()">‚¨áÔ∏è Exportar CSV</button>
          </div>

          <!-- Tabla -->
          <div id="lead-list"></div>

          <!-- Barra de selecci√≥n (solo aparece si hay checks marcados) -->
          <div id="lead-selection" class="selection-bar">
            <span><strong id="lead-selected-count">0</strong> seleccionado(s)</span>
            <button class="btn btn-danger" onclick="deleteSelectedLeads()">üóëÔ∏è Borrar seleccionados</button>
          </div>

          <!-- Paginador compacto -->
          <div id="lead-pager" class="lead-pager">
            <button class="btn btn-outline" onclick="prevLeadPage()">‚¨ÖÔ∏è Anterior</button>
            <span id="lead-page-info">P√°gina 1 / 1</span>
            <button class="btn btn-outline" onclick="nextLeadPage()">Siguiente ‚û°Ô∏è</button>
          </div>
          <!-- M√°s acciones: Backup/Restore JSON -->
          <div class="lead-actions"
            style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:8px;">
            <button class="btn btn-ghost" onclick="exportLeadsJSON()">üíæ Exportar JSON</button>
            <button class="btn btn-outline" onclick="openRestoreLeadsDialog()">‚Ü©Ô∏è Restaurar JSON</button>
          </div>

          <!-- Input oculto para elegir el archivo de respaldo -->
          <input type="file" id="lead-restore-file" accept="application/json" style="display:none" />


          <!-- Acci√≥n secundaria -->
          <div class="lead-actions">
            <button class="btn btn-outline-danger" onclick="clearLeads()">üßπ Borrar todo</button>
          </div>
        </div>


        <div id="sub-mas-actualizacion" class="sub-mas" style="display: none">
          <div id="actualizacion-info">
            <strong>Nueva versi√≥n disponible</strong>
            <ul id="lista-cambios"></ul>
            <button id="btn-actualizar">Actualizar y ver cambios</button>
          </div>
        </div>
      </section>
    </main>

    <!-- === MEN√ö INFERIOR (TABS) === -->
    <nav class="tab-bar">
      <button onclick="cambiarTab('vehiculos')" id="tab-vehiculos" class="active">
        <span class="material-icons">directions_car</span>
        <span>Veh√≠culos</span>
      </button>
      <button onclick="cambiarTab('financiamiento')" id="tab-financiamiento">
        <span class="material-icons">work</span>
        <span>Financiamiento</span>
      </button>
      <button onclick="cambiarTab('mas')" id="tab-mas">
        <span class="material-icons">menu</span>
        <span>M√°s</span>
      </button>
    </nav>
  </div>

  <!-- === MODAL GUARDIAS === -->
  <div id="modalGuardia" class="modal" aria-modal="true" role="dialog" tabindex="-1">
    <div class="modal-content animate-modal">
      <span class="modal-close" id="btnCerrarModal" title="Cerrar">&times;</span>

      <div id="iconModal" style="font-size: 40px; margin-bottom: 10px">üë§</div>
      <h3 id="tituloModalGuardia">Nueva Guardia</h3>

      <label for="tipoEvento">Tipo de evento</label>
      <select id="tipoEvento">
        <option value="guardia">Guardia</option>
        <option value="recordatorio">Recordatorio</option>
      </select>

      <div id="seccionGuardia">
        <label for="nombreGuardia">Nombre del colaborador</label>
        <input type="text" id="nombreGuardia" list="colaboradores" autocomplete="off"
          placeholder="Nombre del colaborador" />
        <!-- datalist cerrado correctamente -->
        <datalist id="colaboradores">
          <!-- Opciones las llena JS si las agregas -->
        </datalist>

        <label for="turnoGuardia">Turno</label>
        <select id="turnoGuardia">
          <option value="am">AM - Ma√±ana</option>
          <option value="pm">PM - Tarde</option>
        </select>
      </div>

      <div id="seccionRecordatorio" style="display: none">
        <label for="tituloRecordatorio">T√≠tulo del recordatorio</label>
        <input type="text" id="tituloRecordatorio" placeholder="Ejemplo: Llamar a proveedor" />
        <label for="notaRecordatorio">Notas</label>
        <textarea id="notaRecordatorio" rows="2" placeholder="Detalles, instrucciones, etc."></textarea>
        <label for="horaRecordatorio">Hora</label>
        <input type="time" id="horaRecordatorio" />
      </div>

      <input type="hidden" id="idGuardia" />

      <button id="guardarGuardia" class="btn-primary">Guardar</button>
      <button id="btnEliminarGuardia" class="btn-danger">Eliminar</button>
      <button id="btnCancelar" class="btn-outline">Cancelar</button>
    </div>
  </div>

  <!-- === JS (orden recomendado) === -->
  <!-- Firebase (Compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <!-- FullCalendar (core en footer para garantizar orden) -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

  <!-- Librer√≠a para exportar PDF -->
  <script src="js/html2pdf.bundle.js"></script>

  <!-- App -->
  <script src="js/app.js"></script>
</body>

</html>